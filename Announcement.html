<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Barangay Market Area Health Information Hub</title>
    <link rel="stylesheet" href="./Announcementtailwind.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="website icon" href="BMA.png" />
  </head>
  <body class="bg-gray-100 text-sm sm:text-base">
    <div class="flex h-screen">
      <!-- Fixed Sidebar -->
      <div
        id="sidebar"
        class="fixed inset-y-0 left-0 w-60 bg-gray-800 text-white flex-shrink-0 flex flex-col transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 z-40"
      >
        <!-- Header -->
        <div
          class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0"
        >
          <span class="ml-3.5 font-semibold text-xm sm:text-sl leading-tight">
            Brgy. Market Area<br />Health Information Hub
          </span>

          <!-- Sidebar close button (for mobile) -->
          <button
            id="closeSidebar"
            class="md:hidden text-white hover:text-gray-300"
          >
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>

        <!-- Menu -->
        <div class="px-3 py-6 overflow-y-auto flex-1">
          <h3 class="text-xs uppercase tracking-wider mb-3">Management</h3>
          <ul class="space-y-2">
            <li>
              <a
                href="Dashboard.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-home text-xs"></i
                ><span class="ml-2 text-sm">Dashboard</span></a
              >
            </li>
            <li>
              <a
                href="Appointment.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-calendar-alt text-xs"></i
                ><span class="ml-2 text-sm">Appointments</span></a
              >
            </li>
            <li>
              <a
                href="Medicine.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-pills text-xs"></i
                ><span class="ml-2 text-sm">Medicine</span></a
              >
            </li>
            <li>
              <a
                href="Resident.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-user text-xs"></i
                ><span class="ml-2 text-sm">Residents</span></a
              >
            </li>
            <li>
              <a
                href="Announcement.html"
                class="flex items-center p-2 font-bold bg-green-600 rounded-lg"
                ><i class="fas fa-bullhorn text-xs"></i
                ><span class="ml-2 text-sm">Announcements</span></a
              >
            </li>
            <li>
              <a
                href="Settings.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-gear text-xs"></i
                ><span class="ml-2 text-sm">Settings</span></a
              >
            </li>
          </ul>
        </div>
      </div>

      <!-- Main Section -->
      <div class="flex flex-col flex-1 h-screen">
        <!-- Fixed Top Bar -->
        <div
          class="w-full bg-gradient-to-r from-gray-800 to-green-600 shadow p-3 sm:p-4 flex justify-between items-center flex-shrink-0"
        >
          <div class="flex items-center gap-2 sm:gap-3">
            <!-- Open sidebar button (mobile only) -->
            <button id="openSidebar" class="md:hidden text-white">
              <i class="fas fa-bars text-lg"></i>
            </button>

            <div
              class="w-12 h-12 sm:w-10 sm:h-10 flex items-center justify-center"
            >
              <img
                src="BMA.png"
                alt="Logo"
                class="w-full h-full object-contain rounded-full"
              />
            </div>
            <h1 class="text-base sm:text-xl font-bold text-white">
              Announcements
            </h1>
          </div>
          <div class="text-white font-medium text-xs sm:text-base">
            <span id="realTimeClock"></span>
          </div>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto bg-gray-100 p-4 lg:p-6">
          <!-- Announcement Section -->
          <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-6">
            <!-- Section Header -->
            <div
              class="bg-gradient-to-r from-gray-800 via-green-700 to-green-500 px-10 py-4"
            >
              <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-white flex items-center">
                  <i class="fa-solid fa-square-plus text-2xl mr-4"></i>
                  Create an Announcement
                </h2>
              </div>
            </div>

            <!-- Section Body -->
            <div class="px-10 py-6 space-y-4">
              <div class="mb-4">
                <h2 class="text-lg font-semibold text-gray-700 mb-1">
                  Announcement Title
                </h2>

                <input
                  id="announcementTitle"
                  type="text"
                  class="w-full border p-2 rounded bg-white text-gray-700"
                  placeholder="Enter announcement title"
                />
              </div>

              <!-- Post Description -->
              <div>
                <h2 class="text-lg font-semibold text-gray-700 mb-1">
                  Announcement Content
                </h2>

                <textarea
                  id="announcementText"
                  rows="3"
                  class="w-full border p-2 rounded bg-white text-gray-700"
                  placeholder="Write your announcement here..."
                ></textarea>
              </div>

              <div class="mb-4">
                <h2 class="text-lg font-semibold text-gray-700 mb-1">
                  Upload Cover Image (optional)
                </h2>

                <label
                  for="imageInput"
                  class="cursor-pointer bg-blue-600 text-white px-4 py-2 rounded inline-block hover:bg-blue-700 transition"
                >
                  Choose File
                </label>
                <input
                  id="imageInput"
                  type="file"
                  accept="image/*"
                  class="hidden"
                />
                <p id="fileName" class="mt-2 text-sm text-gray-600"></p>
              </div>

              <!-- Submit Button -->
              <button
                onclick="submitAnnouncement()"
                class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700"
              >
                Post Announcement
              </button>
            </div>
          </div>

          <!-- Posts Section -->
          <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <!-- Section Header -->
            <div
              class="bg-gradient-to-r from-gray-800 via-green-700 to-green-500 px-10 py-4"
            >
              <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-white flex items-center">
                  <i class="fa-solid fa-bullhorn text-2xl mr-4"></i>
                  Posts
                </h2>
              </div>
            </div>

            <!-- Section Body -->
            <div id="postContainer" class="px-10 py-6 space-y-6">
              <!-- Success Message -->
              <div
                id="successMessage"
                class="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg hidden z-50"
              >
                Announcement posted successfully!
              </div>
              <!-- posts will be dynamically added here -->
            </div>
          </div>
        </div>

        <!-- Edit Announcement Modal -->
        <div
          id="editModal"
          class="fixed inset-0 bg-black/70 hidden z-50 items-center justify-center px-4"
        >
          <div class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-md shadow-lg">
            <h2 class="text-lg font-semibold mb-4">Edit Announcement</h2>

            <!-- Title -->
            <div class="mb-4">
              <label
                for="editTitleInput"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Title</label
              >
              <input
                id="editTitleInput"
                type="text"
                class="w-full border p-2 rounded bg-white text-gray-700"
                placeholder="Edit title here..."
              />
            </div>

            <!-- Description -->
            <div class="mb-4">
              <label
                for="editTextarea"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Content</label
              >
              <textarea
                id="editTextarea"
                rows="4"
                class="w-full border p-2 rounded bg-white text-gray-700 resize-none"
                placeholder="Edit content here..."
              ></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row justify-end gap-2">
              <button
                onclick="closeEditModal()"
                class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500 w-full sm:w-auto"
              >
                Cancel
              </button>
              <button
                onclick="saveEdit()"
                class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 w-full sm:w-auto"
              >
                Save
              </button>
            </div>
          </div>
        </div>

        <div
          id="deleteModal"
          class="fixed inset-0 hidden z-50 items-center justify-center bg-black/70 px-4"
        >
          <div
            class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 text-center relative"
          >
            <i
              class="fa-solid fa-circle-exclamation text-red-600 text-4xl mb-4"
            ></i>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">
              Confirm Deletion
            </h3>
            <p class="text-sm text-gray-600 mb-6">
              Are you sure you want to delete this announcement? <br /><br />
              This action cannot be undone.
            </p>
            <div class="flex justify-center gap-4 flex-col sm:flex-row">
              <button
                onclick="closeDeleteModal()"
                class="px-4 py-2 rounded-md border border-gray-400 text-gray-700 hover:bg-gray-100 transition w-full sm:w-auto"
              >
                Cancel
              </button>
              <button
                onclick="confirmDelete()"
                class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition w-full sm:w-auto"
              >
                <i class="fa-solid fa-trash mr-1"></i> Delete
              </button>
            </div>
            <button
              onclick="closeDeleteModal()"
              class="absolute top-2 right-3 text-gray-400 hover:text-gray-600"
            >
              <i class="fa-solid fa-xmark text-lg"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Clock Script -->
    <script>
      function updateDateTime() {
        const now = new Date();
        const options = {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: true,
        };
        document.getElementById("realTimeClock").textContent =
          now.toLocaleTimeString("en-US", options);
      }
      updateDateTime();
      setInterval(updateDateTime, 1000);

      // Sidebar functionality
      const sidebar = document.getElementById("sidebar");
      const openSidebar = document.getElementById("openSidebar");
      const closeSidebar = document.getElementById("closeSidebar");

      openSidebar?.addEventListener("click", () => {
        sidebar.classList.remove("-translate-x-full");
      });

      closeSidebar?.addEventListener("click", () => {
        sidebar.classList.add("-translate-x-full");
      });

      // Global variable to track post being edited
      let postBeingEdited = null;

      function submitAnnouncement() {
        const imageInput = document.getElementById("imageInput");
        const title = document.getElementById("announcementTitle").value.trim();
        const description = document
          .getElementById("announcementText")
          .value.trim();
        const postContainer = document.getElementById("postContainer");

        if (!title && !description && imageInput.files.length === 0) {
          alert("Please provide at least a title, description, or image.");
          return;
        }

        const getFormattedDate = () => {
          const now = new Date();
          return now.toLocaleString("en-US", {
            dateStyle: "medium",
            timeStyle: "short",
          });
        };

        const processPost = (imageDataUrl = "") => {
          const post = document.createElement("div");
          post.className =
            "post-item border rounded p-4 shadow-sm bg-gray-50 mb-4";

          const postedDate = getFormattedDate();

          const imgHTML = imageDataUrl
            ? `<img src="${imageDataUrl}" class="w-full max-h-60 object-contain rounded mt-3 mb-3" alt="Announcement Image" />`
            : "";

          post.innerHTML = `
        <div class="flex flex-col sm:flex-row sm:justify-between items-start sm:items-center gap-2 sm:gap-4 mb-2">
      <h3 class="post-title text-lg font-semibold text-gray-800 flex-1">${
        title || "Untitled"
      }</h3>
      <p class="text-xs text-gray-500">Posted on: ${postedDate}</p>
    <div class="flex flex-col sm:flex-row gap-2 shrink-0 sm:items-center sm:justify-end w-full sm:w-auto">
    <button onclick="editPost(this)" class="edit-btn text-xs px-3 py-3 bg-yellow-400 text-white rounded hover:bg-yellow-500 transition-colors w-full sm:w-auto">
      <i class="fas fa-edit mr-1"></i>Edit
    </button>
    <button onclick="openDeleteModal(this)" class="delete-btn text-xs px-3 py-3 bg-red-500 text-white rounded hover:bg-red-600 transition-colors w-full sm:w-auto">
      <i class="fas fa-trash mr-1"></i>Delete
    </button>
  </div>
    </div>


    <!-- Hidden data for editing -->
    <div class="post-data hidden">
      <span class="original-title">${title}</span>
      <span class="original-description">${description}</span>
      <span class="original-image">${imageDataUrl}</span>
  </div>
          `;

          // Add to container
          postContainer.appendChild(post);

          // Clear form
          imageInput.value = "";
          document.getElementById("announcementTitle").value = "";
          document.getElementById("announcementText").value = "";

          // Show success message
          const successMessage = document.getElementById("successMessage");
          successMessage.classList.remove("hidden");
          setTimeout(() => {
            successMessage.classList.add("hidden");
          }, 3000);
        };

        if (imageInput.files.length > 0) {
          const reader = new FileReader();
          reader.onload = function (e) {
            processPost(e.target.result);
          };
          reader.readAsDataURL(imageInput.files[0]);
        } else {
          processPost();
        }
      }

      let deleteTarget = null;

      function openDeleteModal(button) {
        deleteTarget = button;
        const modal = document.getElementById("deleteModal");
        modal.classList.remove("hidden");
        modal.classList.add("flex"); // ✅ Add flex when showing
      }

      function closeDeleteModal() {
        deleteTarget = null;
        const modal = document.getElementById("deleteModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex"); // ✅ Remove flex when hiding
      }

      function confirmDelete() {
        if (deleteTarget) {
          const post = deleteTarget.closest(".post-item");
          if (post) {
            post.remove();
          }
          closeDeleteModal();
        }
      }

      function editPost(button) {
        const post = button.closest(".post-item");
        if (!post) {
          console.error("Could not find post container");
          return;
        }

        const postData = post.querySelector(".post-data");
        if (!postData) {
          console.error("Could not find post data");
          return;
        }

        // Get original values
        const title = postData.querySelector(".original-title").textContent;
        const description = postData.querySelector(
          ".original-description"
        ).textContent;

        // Fill modal inputs
        document.getElementById("editTitleInput").value = title;
        document.getElementById("editTextarea").value = description;

        // Show modal
        document.getElementById("editModal").classList.remove("hidden");
        document.getElementById("editModal").classList.add("flex");
        // Store reference to post being edited
        postBeingEdited = post;
      }

      function saveEdit() {
        if (!postBeingEdited) {
          console.error("No post being edited");
          return;
        }

        const newTitle = document.getElementById("editTitleInput").value.trim();
        const newDescription = document
          .getElementById("editTextarea")
          .value.trim();

        // Update visible title
        const titleElement = postBeingEdited.querySelector(".post-title");
        if (titleElement) {
          titleElement.textContent = newTitle || "Untitled";
        }

        // Update visible content
        const contentElement = postBeingEdited.querySelector(".post-content");
        if (contentElement) {
          contentElement.textContent = newDescription || "No content";
        }

        // Update hidden data
        const postData = postBeingEdited.querySelector(".post-data");
        if (postData) {
          const titleSpan = postData.querySelector(".original-title");
          const descSpan = postData.querySelector(".original-description");

          if (titleSpan) titleSpan.textContent = newTitle;
          if (descSpan) descSpan.textContent = newDescription;
        }

        // Close modal
        closeEditModal();
      }

      function closeEditModal() {
        const modal = document.getElementById("editModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex"); // ✅ Remove flex when hiding
        postBeingEdited = null;
      }

      // Close modal when clicking outside
      document
        .getElementById("editModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeEditModal();
          }
        });
    </script>
  </body>
</html>
