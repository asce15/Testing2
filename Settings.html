<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Barangay Market Area Health Information Hub</title>
    <link rel="stylesheet" href="./Settingstailwind.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="website icon" href="BMA.png" />
  </head>
  <body class="bg-gray-100 text-sm sm:text-base">
    <div class="flex min-h-screen">
      <!-- Sidebar with full height -->
      <div
        id="sidebar"
        class="fixed inset-y-0 left-0 w-60 bg-gray-800 text-white flex-shrink-0 flex flex-col transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 z-40"
      >
        <!-- Header -->
        <div
          class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0"
        >
          <span class="ml-3.5 font-semibold text-xm sm:text-sl leading-tight">
            Brgy. Market Area<br />Health Information Hub
          </span>

          <!-- Sidebar close button (for mobile) -->
          <button
            id="closeSidebar"
            class="md:hidden text-white hover:text-gray-300"
          >
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>

        <!-- Menu -->
        <div class="px-3 py-6 overflow-y-auto">
          <h3 class="text-xs uppercase tracking-wider mb-3">Management</h3>
          <ul class="space-y-2">
            <li>
              <a
                href="Dashboard.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-home text-xs"></i
                ><span class="ml-2 text-sm">Dashboard</span></a
              >
            </li>
            <li>
              <a
                href="Appointment.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-calendar-alt text-xs"></i
                ><span class="ml-2 text-sm">Appointments</span></a
              >
            </li>
            <li>
              <a
                href="Medicine.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-pills text-xs"></i
                ><span class="ml-2 text-sm">Medicine</span></a
              >
            </li>
            <li>
              <a
                href="Resident.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-user text-xs"></i
                ><span class="ml-2 text-sm">Residents</span></a
              >
            </li>
            <li>
              <a
                href="Announcement.html"
                class="flex items-center p-2 font-bold hover:bg-green-900 rounded-lg"
                ><i class="fas fa-bullhorn text-xs"></i
                ><span class="ml-2 text-sm">Announcement</span></a
              >
            </li>
            <li>
              <a
                href="Settings.html"
                class="flex items-center p-2 font-bold bg-green-600 hover:bg-green-900 rounded-lg"
                ><i class="fas fa-gear text-xs"></i
                ><span class="ml-2 text-sm">Settings</span></a
              >
            </li>
          </ul>
        </div>
      </div>

      <!-- Main Section -->
      <div class="flex flex-col flex-1 h-screen bg-gray-100">
        <!-- Top Bar -->
        <div
          class="w-full bg-gradient-to-r from-gray-800 to-green-600 shadow p-3 sm:p-4 flex justify-between items-center"
        >
          <div class="flex items-center gap-2 sm:gap-3">
            <!-- Open sidebar button (mobile only) -->
            <button id="openSidebar" class="md:hidden text-white">
              <i class="fas fa-bars text-lg"></i>
            </button>

            <div
              class="w-12 h-12 sm:w-10 sm:h-10 flex items-center justify-center"
            >
              <img
                src="BMA.png"
                alt="Logo"
                class="w-full h-full object-contain rounded-full"
              />
            </div>
            <h1 class="text-base sm:text-xl font-bold text-white">Settings</h1>
          </div>
          <div class="text-white font-medium text-xs sm:text-base">
            <span id="realTimeClock"></span>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto bg-gray-100">
          <!-- Password & Security Section -->
          <div
            class="bg-white rounded-xl shadow-sm overflow-hidden mt-6 mx-4 lg:mx-10"
          >
            <!-- Section Header -->
            <div class="bg-gradient-to-r from-gray-800 to-green-600 px-10 py-4">
              <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-white flex items-center">
                  <i class="fa-solid fa-lock text-2xl mr-4"></i>
                  Password & Security
                </h2>
              </div>
            </div>

            <!-- Section Body -->
            <div class="px-10 py-6 space-y-4">
              <h2 class="text-lg font-semibold text-gray-700">
                Manage Account Settings
              </h2>

              <div
                onclick="openUsernameModal()"
                class="cursor-pointer rounded px-4 py-2 transition duration-200 hover:bg-gradient-to-r hover:from-gray-800 hover:to-green-600 hover:text-white"
              >
                Change Username
              </div>

              <div
                onclick="openPasswordModal()"
                class="cursor-pointer rounded px-4 py-2 transition duration-200 hover:bg-gradient-to-r hover:from-gray-800 hover:to-green-600 hover:text-white"
              >
                Change Password
              </div>

              <!-- Auto Logout Dropdown and Button -->
              <!-- Auto Logout Section -->
              <div class="mt-4 pt-4">
                <label class="block text-lg font-semibold text-gray-700 mb-2">
                  Auto Log out Timer
                </label>
                <div class="flex items-center justify-between">
                  <select
                    id="logoutTimer"
                    onchange="setAutoLogout()"
                    class="w-3/4 border p-2 rounded bg-white text-gray-700"
                  >
                    <option value="">Select Log out time</option>
                    <option value="15">15 Minutes</option>
                    <option value="30">30 Minutes</option>
                    <option value="60">1 Hour</option>
                  </select>
                </div>
              </div>

              <!-- Manual Logout Section -->
              <div class="mt-6 pt-2">
                <div class="flex justify-end">
                  <button
                    onclick="manualLogout()"
                    class="px-10 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700"
                  >
                    Log out
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Change Username Modal -->

        <div
          id="usernameModal"
          class="fixed inset-0 items-center justify-center bg-black/70 hidden z-50 px-4 sm:px-6"
        >
          <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 space-y-4 max-h-[90vh] overflow-y-auto"
          >
            <h2
              class="text-xl font-semibold text-gray-800 flex items-center gap-2"
            >
              <i class="fas fa-user-edit text-black text-2xl"></i>
              Enter New Username
            </h2>

            <div class="relative">
              <i class="fas fa-user absolute top-3 left-3 text-gray-400"></i>
              <input
                type="text"
                id="newUsername"
                placeholder="New username"
                class="w-full pl-10 pr-3 py-2 border rounded"
              />
              <p class="mt-1 text-sm text-gray-500 italic">
                * Must include at least 1 capital letter<br />
                * Must include at least 1 number
              </p>
            </div>

            <button
              onclick="saveUsername()"
              class="w-full bg-green-600 text-white py-2 mt-2 rounded hover:bg-green-700"
            >
              Save
            </button>

            <button
              onclick="closeUsernameModal()"
              class="w-full bg-gray-200 text-gray-800 py-2 rounded hover:bg-gray-300"
            >
              Cancel
            </button>
          </div>
        </div>

        <!-- Step-by-step Change Password Modal -->
        <div
          id="passwordModal"
          class="fixed inset-0 items-center justify-center bg-black/70 hidden z-50 px-4 sm:px-6"
        >
          <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 space-y-4 overflow-y-auto max-h-[90vh]"
          >
            <h2
              class="text-xl font-semibold text-gray-800 flex items-center gap-2"
              id="passwordModalTitle"
            >
              <i class="fas fa-lock text-black text-2xl"></i>
              Change Password
            </h2>

            <!-- Step 1: Current Password -->
            <div id="stepCurrent">
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Enter Current Password
              </label>
              <input
                type="password"
                id="currentPassword"
                class="w-full border p-2 rounded mb-2"
                placeholder="Current password"
              />

              <button
                onclick="goToNextPasswordStep()"
                class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 mt-2"
              >
                Next
              </button>
            </div>

            <!-- Step 2: New Passwords -->
            <div id="stepNewPasswords" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-1">
                New Password
              </label>
              <input
                type="password"
                id="newPassword"
                class="w-full border p-2 rounded mb-3"
                placeholder="New password"
              />
              <p class="mt-1 text-sm text-gray-500 italic mb-2">
                * Password must be at least 8 characters long<br />
                * Must include at least 1 number<br />
                * Must include at least 1 special character (e.g., .,?!{})
              </p>
              <label class="block text-sm font-medium text-gray-700 mb-1">
                Re-enter New Password
              </label>
              <input
                type="password"
                id="confirmPassword"
                class="w-full border p-2 rounded mb-3"
                placeholder="Confirm new password"
              />

              <button
                onclick="updatePassword()"
                class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 mt-2"
              >
                Update Password
              </button>
            </div>

            <button
              onclick="closePasswordModal()"
              class="w-full bg-gray-200 text-gray-800 py-2 rounded hover:bg-gray-300"
            >
              Cancel
            </button>
          </div>
        </div>
        <div
          id="logoutModal"
          class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50"
        >
          <div
            class="bg-white rounded-xl shadow-lg w-[90%] max-w-md p-6 text-center relative"
          >
            <i
              class="fa-solid fa-circle-exclamation text-yellow-500 text-4xl mb-4"
            ></i>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">
              Confirm Logout
            </h3>
            <p class="text-sm text-gray-600 mb-6">
              Are you sure you want to logout? You’ll need to sign in again to
              access your account.
            </p>
            <div class="flex justify-center gap-4">
              <button
                id="cancelLogout"
                class="px-4 py-2 rounded-md border border-gray-400 text-gray-700 hover:bg-gray-100 transition"
              >
                Cancel
              </button>
              <button
                id="confirmLogout"
                class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 transition"
              >
                <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
              </button>
            </div>
            <button
              id="closeLogoutModal"
              class="absolute top-2 right-3 text-gray-400 hover:text-gray-600"
            >
              <i class="fa-solid fa-xmark text-lg"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function updateDateTime() {
        const now = new Date();
        const options = {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: true,
        };
        document.getElementById("realTimeClock").textContent =
          now.toLocaleTimeString("en-US", options);
      }
      updateDateTime();
      setInterval(updateDateTime, 1000);

      function openUsernameModal() {
        const modal = document.getElementById("usernameModal");
        modal.classList.remove("hidden");
        modal.classList.add("flex"); // ✅ Add flex when showing
      }

      function closeUsernameModal() {
        const modal = document.getElementById("usernameModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex"); // ✅ Remove flex when hiding
        document.getElementById("newUsername").value = "";
      }

      function saveUsername() {
        const newUsername = document.getElementById("newUsername").value.trim();

        if (newUsername === "") {
          alert("Username cannot be empty.");
          return;
        }

        // ✅ Validate: must contain at least one capital letter and one number
        const hasCapital = /[A-Z]/.test(newUsername);
        const hasNumber = /\d/.test(newUsername);

        if (!hasCapital || !hasNumber) {
          alert(
            "Username must contain at least one capital letter and one number."
          );
          return;
        }

        // Proceed if valid
        closeUsernameModal();
        alert("Username successfully changed to: " + newUsername);
      }

      function openPasswordModal() {
        const modal = document.getElementById("passwordModal");
        modal.classList.remove("hidden");
        modal.classList.add("flex"); // ✅ add flex dynamically
        document.getElementById("stepCurrent").classList.remove("hidden");
        document.getElementById("stepNewPasswords").classList.add("hidden");
      }

      function closePasswordModal() {
        const modal = document.getElementById("passwordModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex"); // ✅ remove flex when hiding

        // Clear form fields
        document.getElementById("currentPassword").value = "";
        document.getElementById("newPassword").value = "";
        document.getElementById("confirmPassword").value = "";
      }

      function goToNextPasswordStep() {
        const current = document.getElementById("currentPassword").value.trim();

        if (!current) {
          alert("Please enter your current password.");
          return;
        }

        // In a real app, validate current password here
        document.getElementById("stepCurrent").classList.add("hidden");
        document.getElementById("stepNewPasswords").classList.remove("hidden");
      }

      function validatePassword(password) {
        // Check minimum length of 8 characters
        if (password.length < 8) {
          return "Password must be at least 8 characters long.";
        }

        // Check for at least one number
        if (!/\d/.test(password)) {
          return "Password must contain at least one number.";
        }

        // Check for at least one special character
        if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
          return "Password must contain at least one special character.";
        }

        return null; // Password is valid
      }

      function updatePassword() {
        const newPass = document.getElementById("newPassword").value.trim();
        const confirmPass = document
          .getElementById("confirmPassword")
          .value.trim();

        if (!newPass || !confirmPass) {
          alert("Please fill in both password fields.");
          return;
        }

        // Validate new password strength
        const validationError = validatePassword(newPass);
        if (validationError) {
          alert(validationError);
          return;
        }

        if (newPass !== confirmPass) {
          alert("Passwords do not match.");
          return;
        }

        // Submit or save new password here
        closePasswordModal();
        alert("Password successfully changed.");
      }

      let logoutTimeout;

      function setAutoLogout() {
        const selected = document.getElementById("logoutTimer").value;

        if (logoutTimeout) clearTimeout(logoutTimeout); // clear previous

        if (!selected) return;

        const ms = parseInt(selected) * 60 * 1000;

        logoutTimeout = setTimeout(() => {
          alert("Session expired. You have been logged out due to inactivity.");
          window.location.href = "index.html";
        }, ms);

        console.log(`Auto logout in ${selected} minutes.`);
      }

      function manualLogout() {
        document.getElementById("logoutModal").classList.remove("hidden");
      }

      // Modal buttons
      function manualLogout() {
        document.getElementById("logoutModal").classList.remove("hidden");
        document.getElementById("logoutModal").classList.add("flex");
      }

      function closeLogoutModal() {
        const modal = document.getElementById("logoutModal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }

      // Hook up buttons
      document
        .getElementById("cancelLogout")
        .addEventListener("click", closeLogoutModal);
      document
        .getElementById("closeLogoutModal")
        .addEventListener("click", closeLogoutModal);
      document.getElementById("confirmLogout").addEventListener("click", () => {
        window.location.href = "index.html";
      });

      // Reset timer on user interaction
      function resetTimerOnActivity() {
        ["click", "mousemove", "keydown", "scroll"].forEach((evt) => {
          document.addEventListener(evt, () => {
            if (document.getElementById("logoutTimer").value) {
              setAutoLogout(); // reset if dropdown is selected
            }
          });
        });
      }

      // Sidebar functionality
      const sidebar = document.getElementById("sidebar");
      const openSidebar = document.getElementById("openSidebar");
      const closeSidebar = document.getElementById("closeSidebar");
      const backdrop = document.getElementById("sidebar-backdrop");

      openSidebar?.addEventListener("click", () => {
        sidebar.classList.remove("-translate-x-full");
        backdrop.classList.remove("hidden");
      });

      closeSidebar?.addEventListener("click", () => {
        sidebar.classList.add("-translate-x-full");
        backdrop.classList.add("hidden");
      });

      backdrop?.addEventListener("click", () => {
        sidebar.classList.add("-translate-x-full");
        backdrop.classList.add("hidden");
      });

      function handleEdit(button) {
        const container = button.closest("div").closest("div");
        const textarea = container.querySelector("textarea");
        textarea.removeAttribute("readonly");
        textarea.setAttribute("data-editable", "true");
        textarea.focus();
      }

      function handleSave(button) {
        const container = button.closest("div").closest("div");
        const textarea = container.querySelector("textarea");

        if (!textarea.value.trim()) {
          alert("Please enter some content before saving.");
          return;
        }

        textarea.setAttribute("readonly", true);
        textarea.removeAttribute("data-editable");
        alert("Content saved successfully!");
      }

      function handleDelete(button) {
        const container = button.closest("div").closest("div");
        const textarea = container.querySelector("textarea");

        if (confirm("Are you sure you want to delete this information?")) {
          textarea.value = "";
          textarea.setAttribute("readonly", true);
          textarea.removeAttribute("data-editable");
          alert("Content deleted successfully!");
        }
      }

      // Initialize page
      window.addEventListener("DOMContentLoaded", () => {
        // Set all textareas to readonly initially
        document.querySelectorAll("textarea").forEach((textarea) => {
          if (!textarea.hasAttribute("data-editable")) {
            textarea.setAttribute("readonly", true);
          }
        });

        // Initialize auto logout functionality
        resetTimerOnActivity();
      });
    </script>
  </body>
</html>
